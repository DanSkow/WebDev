############## INFORMATIONAL ##############
# This iRule disables ASM/Bot/DoS profiles for IP address/ranges 
# listed in Data Group "dg_asm_whitelist".
# This is an alternative to using Parent profiles since parent/child policies
# can't use the OWASP Top 10 Dashboard

############## SETUP ##############
# 1) Create Address-type Data Group named dg_asm_whitelist
# 2) In the "Address" field, add the IP's or networks to whitelist
# 3) In the "Value" field, add a description for the IP or network

when CLIENT_ACCEPTED {
# Sets variable "disable_asm" to 1 if source IP matches dg_asm_whitelist Data Group
   if {[matchclass [IP::client_addr] equals dg_asm_whitelist]}{
      set disable_asm 1
# If lines 17-18 are commented out or removed, all good traffic will get Connection Reset
   } else {
      set disable_asm 0
   }
}
when HTTP_REQUEST {
    set asm_target [ASM::policy]
# Disables ASM, Bot, and DoS if disable_asm variable is set to 1
      if {$disable_asm==1}{
         ASM::disable
         BOTDEFENSE::disable
         DOSL7::disable
      }
}
